<?php

require_once __DIR__ . '/../vendor/autoload.php';

function include_all_files($folder)
{
    foreach (new DirectoryIterator($folder) as $dir) {
        $path = $dir->getPath() . '/' . $dir->getFilename();
        if ($dir->isDir() && !$dir->isDot()) {
            include_all_files($path);
        } elseif ($dir->getExtension() == 'php') {
            require_once $path;
        }
    }
}

include_all_files(realpath(__DIR__ . '/../src'));

$commands = [];
foreach (get_declared_classes() as $className) {
    if (preg_match('/^Xspf\\\\(.*)Command/', $className)) {
        $refClass = new ReflectionClass($className);

        if ($refClass->isSubclassOf(\Xspf\AbstractCommand::class) && $refClass->isInstantiable()) {
            $commands[] = $className;
        }
    }
}
sort($commands, SORT_ASC);

$content = implode(PHP_EOL, [
    '<?php',
    '// @autogenerated',
    'return ' . json_encode($commands, JSON_PRETTY_PRINT) . ';',
]);

file_put_contents(__DIR__.'/../data/console-commands.php', $content);

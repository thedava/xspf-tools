<?php

require_once __DIR__ . '/../vendor/autoload.php';

$commands = [];
$dir = __DIR__ . '/../src';
foreach (glob($dir . '/Xspf/Console/Command/{*,*/*,*/*/*}Command.php', GLOB_BRACE) as $file) {
    $refClass = new ReflectionClass(str_replace('/', '\\', substr($file, strlen($dir) + 1, -4)));

    if ($refClass->isSubclassOf(Xspf\Console\Command\AbstractCommand::class) && $refClass->isInstantiable()) {
        $commands[] = $refClass->getName();
    }
}
sort($commands, SORT_ASC);

$content = implode("\n", [
    '<?php',
    '// @autogenerated',
    'return ' . json_encode($commands, JSON_PRETTY_PRINT) . ';',
    '',
]);

file_put_contents(__DIR__ . '/../data/console-commands.php', $content);
